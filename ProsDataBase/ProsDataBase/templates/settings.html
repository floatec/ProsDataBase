{% extends "base.html" %}

{% block navigation %}
        <div>users</div>
 <ul id="navigationMenuContent">

			</ul>

{% endblock %}
{% block header %}
        <a class="crumb" href='/settings/' id='settings'> <span>></span></a>


{% endblock %}
{% block content %}
<table id='userSettings'>
    <tr><td>old Password:</td><td><input id='oldPw' type='password'></td></tr>
    <tr><td>new Password:</td><td><input id='newPw' type='password'></td></tr>
    <tr><td>new Password(again):</td><td><input id='confirmNewPw' type='password'></td></tr>

</table>
<button id='saveSettingsButton'>save</button>

{% endblock %}

{% block menu %}

{% endblock %}
{% block javascript %}
<script language="JavaScript">
$.getJSON('/api/myself/',function(data){
        if(data == null){
            window.location = "/login/";
        }
        else{
        if(!data.tableCreator){
            $("#createTableButton").remove();
        }
        if(!data.groupCreator && !data.userManager){
            $("#adminMenu").remove();

        }

        else {
            if(!data.groupCreator){
                $("#groupManagement").remove();
                $("#categoryManagement").remove();

            }

        if(!data.userManager){
            $("#userManagement").remove();
        }
    }
        }
    });
$("#saveSettingsButton").click(function(){
    if(allowNewPassword()){
       var oldpw = {};
        oldpw.password = $("#oldPw").val();
        $.ajax({
        url: '/api/myself/password/',
        type: 'post',
        data: JSON.stringify(oldpw),
        contentType: 'application/json',
        dataType: 'json',
           success: function (data) {
                    if(data.valid){
                          var newpw = {};
                          newpw.password = $("#confirmNewPw").val();
                          $.ajax({
                            url: '/api/myself/password/',
                            type: 'put',
                            data: JSON.stringify(newpw),
                            contentType: 'application/json',
                            dataType: 'json',
                              success: alert("password successfully changed!")

                            });
                    }
                    else
                   alert("password wrong!");
                }
        });
    }
    else{

        alert("repeat your new password!");
    }

});

function allowNewPassword(){
    if($("#newPw").val() == $("#confirmNewPw").val()){
        return true;
    }
    else{
        return false;
    }

}

</script>
{% endblock %}